{% extends 'base.html' %}

{% block module_name %}dashboard{% endblock %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<!-- Header de página -->
<div class="page-header">
    <div class="d-flex justify-content-between align-items-center">
        <h1><i class="fas fa-tachometer-alt"></i> Dashboard</h1>
        <div class="btn-group">
            <a href="{% url 'compra_create' %}" class="btn btn-outline-primary">
                <i class="fas fa-plus"></i> Nueva Compra
            </a>
            <a href="{% url 'venta_create' %}" class="btn btn-outline-success">
                <i class="fas fa-plus"></i> Nueva Venta
            </a>
        </div>
    </div>
</div>

<!-- Tarjetas de Estadísticas -->
<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="card card-stat bg-primary text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title mb-1">Total Productos</h6>
                        <h3 class="mb-0">{{ total_productos }}</h3>
                    </div>
                    <i class="fas fa-box fa-2x opacity-75"></i>
                </div>
                <small class="opacity-75">En el catálogo</small>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="card card-stat bg-success text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title mb-1">Total Clientes</h6>
                        <h3 class="mb-0">{{ total_clientes }}</h3>
                    </div>
                    <i class="fas fa-users fa-2x opacity-75"></i>
                </div>
                <small class="opacity-75">Clientes registrados</small>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="card card-stat bg-warning text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title mb-1">Total Proveedores</h6>
                        <h3 class="mb-0">{{ total_proveedores }}</h3>
                    </div>
                    <i class="fas fa-truck fa-2x opacity-75"></i>
                </div>
                <small class="opacity-75">Proveedores activos</small>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="card card-stat bg-info text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title mb-1">Ventas del Mes</h6>
                        <h3 class="mb-0">${{ ventas_mes|floatformat:2 }}</h3>
                    </div>
                    <i class="fas fa-chart-line fa-2x opacity-75"></i>
                </div>
                <small class="opacity-75">Ingresos del mes actual</small>
            </div>
        </div>
    </div>
</div>

<!-- Contenido principal -->
<div class="row">
    <!-- Productos Más Vendidos -->
    <div class="col-md-6 mb-4">
        <div class="card card-list h-100">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-fire text-danger me-1"></i>
                    Productos Más Vendidos
                </h5>
            </div>
            <div class="card-body">
                {% if productos_mas_vendidos %}
                <div class="table-responsive">
                    <table class="table table-standard">
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th>Cantidad Vendida</th>
                                <th>Ingresos</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for producto in productos_mas_vendidos %}
                            <tr>
                                <td>{{ producto.id_producto__nombre }}</td>
                                <td>
                                    <span class="badge badge-standard bg-primary">
                                        {{ producto.total_vendido }}
                                    </span>
                                </td>
                                <td class="text-success fw-bold">
                                    ${{ producto.total_ingresos|floatformat:2 }}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state py-3">
                    <div class="empty-state-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <h6 class="empty-state-title">Sin datos de ventas</h6>
                    <p class="empty-state-message">
                        No hay productos vendidos para mostrar.
                    </p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Resumen de Compras -->
    <div class="col-md-6 mb-4">
        <div class="card card-list h-100">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-shopping-cart text-primary me-1"></i>
                    Resumen de Compras del Mes
                </h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-6">
                        <h3 class="text-primary">${{ compras_mes|floatformat:2 }}</h3>
                        <p class="text-muted">Total Compras</p>
                    </div>
                    <div class="col-6">
                        <h3 class="text-success">{{ compras_mes.cantidad|default:0 }}</h3>
                        <p class="text-muted">Unidades Compradas</p>
                    </div>
                </div>
                
                <div class="mt-4">
                    <h6 class="fw-bold mb-3">
                        <i class="fas fa-calendar-alt me-1"></i>
                        Últimas Compras
                    </h6>
                    <div class="list-group list-group-flush">
                        {% for compra in ultimas_compras|slice:":3" %}
                        <div class="list-group-item">
                            <div class="d-flex w-100 justify-content-between">
                                <small>{{ compra.id_producto.nombre|truncatechars:20 }}</small>
                                <small class="text-danger fw-bold">
                                    ${{ compra.costo_total|floatformat:2 }}
                                </small>
                            </div>
                            <small class="text-muted">
                                {{ compra.fecha|date:"d/m/Y" }}
                            </small>
                        </div>
                        {% empty %}
                        <div class="list-group-item text-muted">
                            <small>No hay compras recientes</small>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Acciones Rápidas -->
<div class="card card-form mt-4">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="fas fa-bolt text-warning me-1"></i>
            Acciones Rápidas
        </h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-3 mb-2">
                <a href="{% url 'compra_create' %}" class="btn btn-primary-standard w-100">
                    <i class="fas fa-plus-circle"></i> Nueva Compra
                </a>
            </div>
            <div class="col-md-3 mb-2">
                <a href="{% url 'venta_create' %}" class="btn btn-success-standard w-100">
                    <i class="fas fa-plus-circle"></i> Nueva Venta
                </a>
            </div>
            <div class="col-md-3 mb-2">
                <a href="{% url 'catalogo' %}" class="btn btn-warning-standard w-100">
                    <i class="fas fa-book"></i> Gestionar Catálogo
                </a>
            </div>
            <div class="col-md-3 mb-2">
                <a href="{% url 'inventario_list' %}" class="btn btn-info-standard w-100">
                    <i class="fas fa-boxes"></i> Ver Inventario
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.btn-success-standard {
    background-color: var(--color-success);
    border-color: var(--color-success);
    color: white;
}

.btn-warning-standard {
    background-color: var(--color-warning);
    border-color: var(--color-warning);
    color: var(--color-dark);
}

.btn-info-standard {
    background-color: var(--color-info);
    border-color: var(--color-info);
    color: white;
}
</style>
{% endblock %}